<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script type="text/javascript" src="bower_components/sails.io.js/dist/sails.io.js"></script>
    <script type="text/javascript">
        io.sails.autoConnect = false;

        console.log('io');
        console.log(io);

        var socket = io.sails.connect('https://player.me:443', {
            transports: ['websocket']
        });

        var logOnEvent = function(eventIdentity){
            socket.on(eventIdentity, function(){
                console.log(eventIdentity, arguments);
            });
        };
        var errOnEvent = function(eventIdentity){
            socket.on(eventIdentity, function(){
                console.error(eventIdentity, arguments);
            });
        };

        logOnEvent('connect');
        errOnEvent('error');
        logOnEvent('disconnect');
        logOnEvent('reconnect');
        logOnEvent('reconnect_attempt');
        logOnEvent('reconnecting');
        errOnEvent('reconnect_error');
        errOnEvent('reconnect_failed');

        logOnEvent('test');
        logOnEvent('feed');
        logOnEvent('feed-new');
        logOnEvent('friend:online');
        logOnEvent('notifications:new');
        logOnEvent('notifications:mark_all_read');


        sendVerify(false, function(body, JWR){
            console.log('verify', {
                body: body,
                statusCode: JWR.statusCode,
                headers: JWR.headers
            });

            sendTest('ping');
            subscribeFeed();
        });


        function sendTest(message){
            socket.post('/test', { message: message });
        }

        function sendVerify(oauthAccessToken, callback){
            var params = null;
            if (oauthAccessToken) params = { access_token: oauthAccessToken };
            socket.post('/verify', params, callback);
        }

        function subscribeFeed(key){
            if (!key) key = 'general';
            console.log("subscribeFeed >>",key);
            socket.post('/rooms', { channel:'feed', key:key }, function(){
                console.log("subscribeFeed <<", arguments);
            });
        }
    </script>

</head>
<body>

</body>
</html>