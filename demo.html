<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <script type="text/javascript" src="bower_components/sails.io.js/dist/sails.io.js"></script>
    <script type="text/javascript">
        io.sails.autoConnect = false;

        var socket = io.sails.connect('https://player.me:443', {
            transports: ['websocket']
        });

        var logOnEvent = function(eventIdentity){
            console.log(eventIdentity, '...');
            socket.on(eventIdentity, function(){
                var args = Array.prototype.slice.call(arguments);
                args = [eventIdentity, '<<'].concat(args.length ? args : [undefined]);
                console.log.apply(console, args);
            });
        };
        var errOnEvent = function(eventIdentity){
            console.log(eventIdentity, '...');
            socket.on(eventIdentity, function(){
                var args = Array.prototype.slice.call(arguments);
                args = [eventIdentity, '<<'].concat(args.length ? args : [undefined]);
                console.error.apply(console, args);
            });
        };

        logOnEvent('connect');
        errOnEvent('error');
        logOnEvent('disconnect');
        logOnEvent('reconnect');
        logOnEvent('reconnect_attempt');
        logOnEvent('reconnecting');
        errOnEvent('reconnect_error');
        errOnEvent('reconnect_failed');

        logOnEvent('test');
        logOnEvent('feed');
        logOnEvent('feed-new');
        logOnEvent('friend:online');
        logOnEvent('notifications:new');
        logOnEvent('notifications:mark_all_read');


        sendVerify(false, function(body, JWR){
            console.log('verify', '<<', {
                body: body,
                statusCode: JWR.statusCode,
                headers: JWR.headers
            });

            subscribeFeed();
            sendTest('ping');
        });


        function sendTest(message){
            var params = { message: message };
            console.log('test', '>>', params);
            socket.post('/test', params);
        }

        function sendVerify(oauthAccessToken, callback){
            var params = null;
            if (oauthAccessToken) params = { access_token: oauthAccessToken };
            console.log('verify', '>>', params);
            socket.post('/verify', params, callback);
        }

        function subscribeFeed(key){
            if (!key) key = 'general';
            var params = { channel:'feed', key:key };
            console.log('subscribe-feed', '>>', params);
            socket.post('/rooms', params, function(){
                console.log("ubscribe-feed <<", arguments);
            });
        }
    </script>

</head>
<body>

</body>
</html>